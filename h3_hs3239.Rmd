---
title: "p8105_hw3_hs3239"
author: "hanfu shi"
date: "2021/10/14"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
library(p8105.datasets)
data("instacart")

```

#Setting
```{r}
library(tidyverse)
library(readxl)
library(devtools)
library(dplyr)
library(ggplot2)
library(patchwork)
library(ggridges)
knitr::opts_chunk$set(
  fig.width = 6,
  fig.asp = 0.6,
  out.width = "90%"
)
theme_set(theme_minimal() + theme(legend.position = "bottom"))
options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)
scale_colour_discrete = scale_color_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```

Problem 1
```{r}
#find the distinct id numbers
instacart_aisles = select(instacart, order_number,aisle_id)
id_number= count(instacart_aisles,aisle_id)



```
The dataset contains`r nrow(instacart)` rows and `r ncol(instacart)` columns(variables)
The key variables are Aisles, Aisles's ID and order ID. There are`r nrow(id_number)` aisles and fresh vegetables are the most item ordered.


```{r}
#P1 plot
instacart %>% 
  count(aisle) %>% 
  filter(n > 10000) %>% 
  mutate(
    aisle = factor(aisle),
    aisle = fct_reorder(aisle, n)
  ) %>% 
  ggplot(aes(x = aisle, y = n)) +
  geom_point()+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))+
  labs(title = "Aisle plot",
       x =  "Different Aisles",
       y = "Number of order",
       caption = "Data from instacart datasets")
```


```{r}
#p1 table1
instacart %>% 
  filter(aisle %in% c("baking ingredients", "dog food care", "packaged vegetables fruits")) %>% 
  group_by(aisle) %>% 
  count(product_name) %>% 
  mutate(rank = min_rank(desc(n))) %>% 
  filter(rank <=3) %>% 
  arrange(aisle, rank) %>% 
  knitr::kable()
```


```{r}
#p1 table2
instacart %>% 
  filter(product_name %in% c("Pink Lady Apples", "Coffee Ice Cream")) %>% 
  group_by(product_name, order_dow) %>% 
  summarise(mean_hour = mean(order_hour_of_day)) %>% 
  pivot_wider(
    names_from = order_dow,
    values_from = mean_hour
  )%>%
  knitr::kable()

```

Problem2

```{r}
library(p8105.datasets)
brfss_smart2010=p8105.datasets::brfss_smart2010
```


import and clean the data
```{r}
brfss_df=
brfss_smart2010%>% 
    janitor::clean_names()%>%
 filter(topic == "Overall Health") %>%
    separate(locationdesc, into = c('state', 'location'), sep = ' - ') %>%
    mutate(response = as.factor(response)) %>%
    filter(response == "Excellent"  | response == "Very good" |          response == "Good" | response == "Fair" | response == "Poor") 

#assign 5 levels to response variables
brfss_df$response= factor(brfss_df$response,
  levels <- (c("Excellent","Very good", "Good", "Fair", "Poor")))



```



```{r}
brfss_df_location = filter(brfss_df, year == "2002")%>%
  group_by(state)%>%
  distinct(location)%>%
  summarise(n = n())%>% 
  filter(n >=7)


```

In 2002, CT FL MA NC NJ PA observed at 7 or more locations


```{r}
brfss_df_location_2010 = filter(brfss_df, year == "2010")%>%
  group_by(state)%>%
  distinct(location)%>%
  summarise(n = n())%>% 
  filter(n >=7)

```
In 2002, CO PA SC OH MA NY NE WA CA MD NC TX NJ FL were observed at 7 or more locations

```{r}
brfss_excellent =filter(brfss_df, response == "Excellent")%>% 
  select(year, state,data_value)%>%
  group_by(state,year)%>%
  mutate(
    value_mean = mean(data_value, na.rm = TRUE)
  )%>%
  select(-data_value)
 
  
 
  
  ggplot(brfss_excellent,aes(x = year, y = value_mean, group=state)) +
 geom_line()+


  labs(title = " “spaghetti” plot  ",
       x =  "year",
       y = "mean_value",
       caption = "Data from brfss_smart2010 datasets")


```




Two panel plot
```{r}
brr=
brfss_df%>%

  filter( year == 2006 | year== 2010 )%>%
    filter(state =="NY")%>%
  drop_na(response)%>%
  group_by(location)
  
    ggplot(brr, aes(x = response, y = data_value,group=location))+
      geom_point()+
      geom_line()+
     facet_grid(. ~ year) 

```




P3

```{r}
accel_df = 
  read_csv("./data/accel_data.csv", col_types = cols(
      week = col_integer(),
      day_id = col_integer()
      )) %>%
  janitor::clean_names() %>% 
  mutate(
    weekend = case_when(
      day == "Monday" ~ "weekday",
      day == "Tuesday" ~ "weekday",
      day == "Wednesday" ~ "weekday",
      day == "Thursday" ~ "weekday",
      day == "Friday" ~ "weekday",
      day == "Saturday" ~ "weekend",
      day == "Sunday" ~ "weekend"
)) %>% 
  relocate("weekend") %>%
  pivot_longer(
    activity_1:activity_1440, 
    names_to = "activity",
    values_to = "activity_count") %>% 
  separate(activity, into = c("activity", "activity_minute")) %>%
  select(-activity) %>%
  mutate(
    activity_minute = as.numeric(activity_minute),
    day = factor(day),
    day = fct_relevel(day, c("Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"))
    )

```

The resulting dataset contains 50400 observations and 6 variables and contains 5 weeks of activity.


```{r}


```
